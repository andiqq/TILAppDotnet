@using Microsoft.AspNetCore.Components.QuickGrid
@inject Context Context
@inject NavigationManager NM
@attribute [StreamRendering]
@namespace TILAppBlazorSSR.Components.Pages

    @if (acronyms == null || !acronyms.Any())
    {
        <p>
            <em>There aren't any Acronyms yet</em>
        </p>
    }
    else
    {
        <QuickGrid Class="table align-middle table-bordered table-hover" Items="acronyms">

            <PropertyColumn Property="acronym => acronym.Short"/>
            <PropertyColumn Property="acronym => acronym.Long"/>
            <PropertyColumn Property="acronym => acronym.User.Name"/>

            <TemplateColumn Context="acronym">
                <form method="post" data-enhance
                      @formname="@($"DeleteAcronymForm{acronym.Id}")"
                      @onsubmit="() => DeleteAcronym(acronym.Id)">

                    <a class="btn btn-primary" href="acronym-details/@acronym.Id" role="button">Details</a>&nbsp;
                    <a class="btn btn-secondary" href="edit-acronym/@acronym.Id" role="button">Edit</a>&nbsp;
                    <button class="btn btn-danger">
                        Delete
                    </button>
                    <AntiforgeryToken/>

                </form>
            </TemplateColumn>

        </QuickGrid>
    }


@code {

    [Parameter] public IQueryable<Acronym> acronyms { get; set; }

    public async Task DeleteAcronym(int id)
    {
        var acronym = await Context.Acronym.FindAsync(id);
        if (acronym is not null)
        {
            Context.Remove(acronym);
            await Context.SaveChangesAsync();
            acronyms = Context.Acronym;
            NM.Refresh();
        }
    }

}